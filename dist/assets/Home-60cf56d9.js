import{C as v}from"./CardList-d2632876.js";import{_,s as h,o,c as a,a as l,t as C,r as u,F as P,b as S,d as g,e as x,w as f,v as p}from"./index-485fe2e4.js";const k={props:{id:{type:Number},edited:{type:Boolean,default:!1},title:{type:String,default:"Ma playlist"},image:{type:String,default:"/assets/playlist.svg"},songs:{type:Array,default:[]}},computed:{toBodyRequest(){return{id:this.id,edited:this.edited,name:this.title,image:this.image,songs:this.songs,toJSON(){return delete this.edited,this}}}},methods:{updateTitle(t){this.toBodyRequest.name=t.target.value,this.$emit("updateTitle",this.toBodyRequest)},addSong(t){t.target.className.includes("inline-card")&&this.$emit("add-song",this.toBodyRequest)}},data(){return{store:h}}},B=["data-id"],$=["src"],R={class:"inline-card__title"},E=l("i",{class:"material-symbols-outlined"},"delete",-1),F=["data-id"],I=["src"],L=["value"];function T(t,e,s,r,c,i){return s.edited?(o(),a("div",{key:1,"data-id":s.id,class:"inline-card"},[l("img",{src:s.image,class:"inline-card__img"},null,8,I),l("input",{type:"text",class:"inline-card__title",value:s.title,onChange:e[2]||(e[2]=(...n)=>i.updateTitle&&i.updateTitle(...n))},null,40,L),l("i",{class:"material-symbols-outlined",onClick:e[3]||(e[3]=n=>t.$emit("toggleEdit",this.toBodyRequest))},"done")],8,F)):(o(),a("div",{key:0,"data-id":s.id,class:"inline-card",onClick:e[1]||(e[1]=(...n)=>i.addSong&&i.addSong(...n))},[l("img",{src:s.image,class:"inline-card__img"},null,8,$),l("p",R,C(s.title),1),l("i",{class:"material-symbols-outlined",onClick:e[0]||(e[0]=n=>t.$emit("toggleEdit",this.toBodyRequest))},"edit"),E],8,B))}const b=_(k,[["render",T]]),N={data(){return{store:h,localPlaylists:[]}},computed:{existingPlaylists(){return this.store.list.playlist.items.concat(this.localPlaylists)}},methods:{addLocalPlaylist(t={edited:!0}){this.localPlaylists.push(t)},toggleEdit(t){const e=this.existingPlaylists.find(s=>s.id===t.id);e.edited=!e.edited,e.edited||this.upsertPlaylist(t)},async upsertPlaylist(t){let e=this.store.list.playlist.items.findIndex(s=>s.id===t.id);if(e===-1){t.id=await this.store.insertPlaylist(t),this.store.list.playlist.items.push(t);let s=this.localPlaylists.findIndex(r=>r.id===t.id);this.localPlaylists.splice(s,1),localStorage.setItem("playlistsId",JSON.stringify(this.store.list.playlist.items.map(r=>r.id)))}else this.store.list.playlist.items[e]={...t,title:t.name},this.store.patchPlaylist(t),this.existingPlaylists[e].edited=!1},addSong(t){t.songs.some(e=>e===this.store.clickedSong)||(t.songs.push(this.store.clickedSong),this.upsertPlaylist(t)),this.store.hideForm()}},components:{InlineCard:b}},q={class:"form-playlist"},w=l("h1",{class:"form-playlist__title"},"Enregistrer dans",-1),A={key:0,class:"form-playlist__list"};function V(t,e,s,r,c,i){const n=u("InlineCard");return o(),a("div",q,[l("span",{class:"material-symbols-outlined form-playlist__close",onClick:e[0]||(e[0]=d=>c.store.hideForm())}," close "),w,i.existingPlaylists.length>0?(o(),a("ul",A,[(o(!0),a(P,null,S(i.existingPlaylists,d=>(o(),a("li",null,[g(n,{id:d.id,title:d.title,edited:d.edited,songs:d.song,image:d.image,onToggleEdit:i.toggleEdit,onUpdateTitle:i.upsertPlaylist,onAddSong:i.addSong},null,8,["id","title","edited","songs","image","onToggleEdit","onUpdateTitle","onAddSong"])]))),256))])):x("",!0),l("i",{class:"form-playlist__add material-symbols-outlined",onClick:e[1]||(e[1]=d=>i.addLocalPlaylist())}," add ")])}const J=_(N,[["render",V]]),O={name:"App",data(){return{store:h}},components:{CardList:v,PlaylistForm:J},async created(){await this.store.initialize()}},U={class:"container"},z={class:"container__lists"},H={class:"container__lists__item"};function M(t,e,s,r,c,i){const n=u("PlaylistForm"),d=u("CardList");return o(),a("main",U,[f(g(n,null,null,512),[[p,c.store.showPlaylistForm]]),l("ul",z,[(o(!0),a(P,null,S(c.store.list,(m,y)=>(o(),a("li",H,[f(g(d,{detailRoute:m.detailRoute,name:y,isSongList:y==="songs",title:m.title,cards:m.items},null,8,["detailRoute","name","isSongList","title","cards"]),[[p,m.items.length>0]])]))),256))])])}const K=_(O,[["render",M]]);export{K as default};
